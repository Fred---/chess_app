
  def challenge
    @user = current_user
    channel = @user.name.to_s + @user.id.to_s
    broadcast_message :challenge, { 
      user_name: @user.name,
      user_id: @user.id,
      msg_body: 'hello'
    }
    WebsocketRails[channel].trigger(:info, @user.id)
  end

    def challenge_accepted
    @user1 = current_user
    channel1 = @user.name.to_s + @user.id.to_s
    @user2 = User.find(message[:challenger_id])
    channel2 = @user2.name.to_s + @user2.id.to_s
    g = Game.create(pgn: "")
    WebsocketRails[channel1].trigger(:game_start, game_id: g.id.to_s)
    WebsocketRails[channel2].trigger(:game_start, game_id: g.id.to_s)
  end

  chatController.dispatcher.trigger 'game_move', {user_id: user_id, game_id: game_id, fen: game.fen(), pgn: game.pgn}



    def game_move
    user1 = current_user
    user2_game = UserGame.where("game_id = :game_id AND colour = :colour",
    {game_id: message[:game_id], colour: message[:colour]})
    user2 = User.find(user2_game.user_id)
    channel = user2.name.to_s + user2.id.to_s

    system_msg :new_message, user1.name
    WebsocketRails[channel].trigger(:game_move, {
      user_id: user2.id.to_s,
      game_id: message[:game_id],
      fen: message[:fen],
      pgn: message[:pgn],
      colour: message[:colour]
    })
    
  end